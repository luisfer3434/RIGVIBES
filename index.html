<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RIGVIBES | Simulator Perakitan PC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" xintegrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen">
    <script type="module">
        // Impor Firebase dihilangkan karena menggunakan LocalStorage
        // Import untuk API Gemini tetap ada untuk fitur deskripsi AI

        // --- Konfigurasi Penyimpanan Lokal ---
        const APP_ID = 'RIGVIBES_V2_LOCAL';
        const COMPONENTS_KEY = `${APP_ID}_COMPONENTS`;
        const MY_BUILDS_KEY = `${APP_ID}_MY_BUILDS`;
        const GALLERY_KEY = `${APP_ID}_GALLERY`;
        
        // ID pengguna anonim simulasi (diganti dengan ID unik lokal)
        const userId = crypto.randomUUID();


        // --- App State ---
        const appState = {
            currentView: 'simulator', // 'simulator', 'myBuilds', 'gallery', 'admin'
            components: {
                cpu: [], gpu: [], motherboard: [], ram: [], psu: [], storage: [], case: []
            },
            currentBuild: { buildName: 'Rakitan Saya' },
            compatibility: {
                status: 'Memeriksa...',
                details: []
            },
            cost: 0,
            myBuilds: [],
            publicBuilds: [],
            modal: {
                visible: false,
                category: null,
                data: []
            },
            toast: {
                visible: false,
                message: '',
                type: 'success'
            },
            isLoading: false,
            geminiDescription: 'Buat deskripsi untuk mendapatkan ringkasan rakitan yang didukung AI!'
        };

        // --- Utility Functions ---

        /** Menampilkan pesan toast sementara. */
        function showToast(message, type = 'success') {
            appState.toast = { visible: true, message, type };
            renderApp();
            setTimeout(() => {
                appState.toast.visible = false;
                renderApp();
            }, 3000);
        }

        fetch('./component.json')
            .then(res => res.json())
                .then(data => {
            console.log(data);
            });

        /** Kloning dalam objek sederhana. */
        const deepClone = (obj) => JSON.parse(JSON.stringify(obj));

        /** Menghasilkan ID unik untuk LocalStorage. */
        const generateId = () => Date.now().toString(36) + Math.random().toString(36).substring(2, 9);

        /** Memeriksa apakah build saat ini memiliki komponen yang cukup untuk valid. */
        const isBuildValid = (build) => {
            const required = ['cpu', 'motherboard', 'ram', 'psu', 'case'];
            return required.every(cat => build[cat]);
        }
        
        // --- LocalStorage Persistence (Mengganti Firebase) ---

        /** Memuat data dari LocalStorage. */
        function loadFromLocalStorage(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error(`Error loading from LocalStorage key ${key}:`, error);
                return defaultValue;
            }
        }

        /** Menyimpan data ke LocalStorage. */
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error(`Error saving to LocalStorage key ${key}:`, error);
                showToast("Gagal menyimpan data lokal.", 'error');
            }
        }

        /** Inisialisasi data aplikasi dari mock data atau LocalStorage. */
        async function initData() {
        // Coba load dari localStorage
        let storedComponents = loadFromLocalStorage(COMPONENTS_KEY, null);

        if (!storedComponents) {
            try {
                const REPO_NAME = 'rigvibes'; // <--- Ganti dengan nama repositori Anda!
                const res = await fetch(`/${REPO_NAME}/component.json`);
                const data = await res.json();
                const structuredData = {};
                // Kategorikan array tunggal menjadi objek dengan kategori sebagai key
                data.forEach(comp => {
                const cat = comp.category.toLowerCase();
                if (!structuredData[cat]) {
                    structuredData[cat] = [];
                }
                structuredData[cat].push(comp);
            });

            saveToLocalStorage(COMPONENTS_KEY, structuredData);
            appState.components = structuredData;

                // Asumsikan data sudah dalam bentuk objek bernama categories
                saveToLocalStorage(COMPONENTS_KEY, data);
                storedComponents = data;
                console.log("Komponen dari component.json disimpan ke LocalStorage.");
            } catch (err) {
                console.error("Gagal memuat component.json", err);
                showToast("Gagal memuat daftar komponen.", "error");
                storedComponents = {};
            }
        }

            appState.components = storedComponents;
            appState.myBuilds = loadFromLocalStorage(MY_BUILDS_KEY);
            appState.publicBuilds = loadFromLocalStorage(GALLERY_KEY);

            calculateBuildStatus();
            renderApp();
        }


        // --- Core Logic: Compatibility and Cost ---

        function calculateBuildStatus() {
            const build = appState.currentBuild;
            let totalCost = 0;
            const compatibilityChecks = [];
            let status = 'OK';

            // Memeriksa apakah semua komponen wajib dipilih
            const requiredCategories = ['cpu', 'motherboard', 'ram', 'psu', 'case'];
            requiredCategories.forEach(cat => {
                if (!build[cat]) {
                    compatibilityChecks.push({ message: `Komponen wajib hilang: ${cat.toUpperCase()}`, type: 'warning' });
                }
            });

            // 1. Perhitungan Biaya
            Object.values(build).forEach(component => {
                if (component && component.price) {
                    totalCost += Number(component.price);
                }
            });

            // 2. Pemeriksaan Kompatibilitas
            const cpu = build.cpu;
            const mobo = build.motherboard;
            const ram = build.ram;
            const psu = build.psu;

            if (cpu && mobo) {
                // Cek Socket
                if (cpu.socket !== mobo.socket) {
                    compatibilityChecks.push({ message: `Socket CPU (${cpu.socket}) tidak kompatibel dengan Motherboard (${mobo.socket}).`, type: 'error' });
                    status = 'Error';
                }
                // Cek TDP/Daya (Sederhana)
                if (Number(cpu.tdp) > 200 && mobo.chipset && mobo.chipset.startsWith('H')) {
                    compatibilityChecks.push({ message: `CPU TDP tinggi (${cpu.tdp}W) mungkin tidak ideal untuk chipset Motherboard kelas rendah (${mobo.chipset}).`, type: 'warning' });
                }
            }

            if (cpu && ram) {
                // Cek Tipe RAM
                if (cpu.ramType && ram.type && cpu.ramType !== ram.type) {
                    compatibilityChecks.push({ message: `CPU membutuhkan RAM ${cpu.ramType}, tetapi ${ram.type} dipilih.`, type: 'error' });
                    status = 'Error';
                }
            }

            if (ram && mobo) {
                // Cek Tipe RAM Motherboard
                if (mobo.ramType && ram.type && mobo.ramType !== ram.type) {
                     compatibilityChecks.push({ message: `Motherboard membutuhkan RAM ${mobo.ramType}, tetapi ${ram.type} dipilih.`, type: 'error' });
                     status = 'Error';
                }
            }

            if (psu) {
                // Cek Watt PSU (Sangat disederhanakan: CPU + GPU * 1.5)
                const requiredWattage = (cpu?.tdp || 65) + (build.gpu?.tdp || 150);
                if (Number(psu.wattage) < requiredWattage * 1.5) {
                    compatibilityChecks.push({ message: `Watt PSU (${psu.wattage}W) rendah. Minimal yang direkomendasikan: ${Math.round(requiredWattage * 1.5)}W.`, type: 'warning' });
                }
            }

            // Penentuan Status Akhir
            if (compatibilityChecks.some(c => c.type === 'error')) {
                status = 'Error';
            } else if (compatibilityChecks.some(c => c.type === 'warning')) {
                status = 'Peringatan';
            } else if (!isBuildValid(build)) {
                status = 'Belum Lengkap';
            } else {
                status = 'Kompatibel';
            }

            appState.cost = totalCost;
            appState.compatibility = { status, details: compatibilityChecks };
            renderApp();
        }

        // --- API Call: Gemini Description (Tetap menggunakan API) ---
        async function generateBuildDescription() {
            if (appState.isLoading) return;

            appState.isLoading = true;
            appState.geminiDescription = 'AI sedang membuat deskripsi RIG...';
            renderApp();

            const build = appState.currentBuild;
            const buildName = build.buildName || 'Rakitan Tanpa Nama';
            const componentsList = Object.entries(build)
                .filter(([, comp]) => comp && comp.name)
                .map(([cat, comp]) => `${cat.toUpperCase()}: ${comp.name}`)
                .join(', ');

            if (!componentsList) {
                appState.geminiDescription = 'Silakan pilih komponen terlebih dahulu.';
                appState.isLoading = false;
                renderApp();
                return;
            }

            const prompt = `Act as an enthusiastic PC building expert. Generate a concise, one-paragraph creative summary (under 80 words) for a PC build named "${buildName}". Focus on its performance potential and aesthetics based on the following components: ${componentsList}.`;

            const apiKey = ""; // Dibiarkan kosong karena disediakan oleh lingkungan runtime
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: {
                    parts: [{ text: "You are a creative PC building enthusiast and marketer. Your response must be a single, short paragraph." }]
                },
            };

            let responseText = "Gagal membuat deskripsi. (Akses API Gemini dibatasi atau gagal)";
            let retries = 0;
            const maxRetries = 3;

            while (retries < maxRetries) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        responseText = candidate.content.parts[0].text;
                        break; // Berhasil
                    }
                } catch (error) {
                    console.error(`Attempt ${retries + 1} failed:`, error);
                    retries++;
                    if (retries < maxRetries) {
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, retries) * 1000)); // Exponential backoff
                    }
                }
            }

            appState.geminiDescription = responseText;
            appState.isLoading = false;
            renderApp();
        }


        // --- Data Persistence (CRUD LocalStorage) ---

        /** Menghapus build saat ini */
        function clearCurrentBuild() {
            appState.currentBuild = { buildName: 'Rakitan Baru' };
            appState.geminiDescription = 'Buat deskripsi untuk mendapatkan ringkasan rakitan yang didukung AI!';
            calculateBuildStatus();
        }

        /** Menyimpan build saat ini ke LocalStorage (Pribadi) */
        function saveBuild() {
            if (!isBuildValid(appState.currentBuild)) {
                showToast("Rakitan harus memiliki CPU, MB, RAM, PSU, dan Casing untuk disimpan.", 'error');
                return;
            }

            const buildData = deepClone(appState.currentBuild);
            buildData.cost = appState.cost;
            buildData.compatibility = appState.compatibility.status;
            buildData.description = appState.geminiDescription;
            buildData.timestamp = Date.now();
            buildData.userId = userId;
            buildData.buildName = buildData.buildName || 'Rakitan Tanpa Nama';

            // Cek apakah ini pembaruan (jika sudah ada ID), atau build baru
            if (!buildData.id) {
                buildData.id = generateId();
            }

            const existingIndex = appState.myBuilds.findIndex(b => b.id === buildData.id);

            if (existingIndex !== -1) {
                appState.myBuilds[existingIndex] = buildData;
                showToast(`Rakitan "${buildData.buildName}" diperbarui!`, 'success');
            } else {
                appState.myBuilds.push(buildData);
                showToast(`Rakitan "${buildData.buildName}" disimpan!`, 'success');
            }
            
            saveToLocalStorage(MY_BUILDS_KEY, appState.myBuilds);
            renderApp();
        }

        /** Memuat build yang tersimpan ke simulator */
        function loadBuild(build) {
            appState.currentBuild = deepClone(build);
            appState.geminiDescription = build.description || 'Buat deskripsi untuk mendapatkan ringkasan rakitan yang didukung AI!';
            calculateBuildStatus();
            appState.currentView = 'simulator';
            renderApp();
            showToast(`Rakitan "${build.buildName}" dimuat ke Simulator.`, 'success');
        }

        /** Menghapus build yang tersimpan (Pribadi) */
        function deleteBuild(buildId) {
            appState.myBuilds = appState.myBuilds.filter(b => b.id !== buildId);
            saveToLocalStorage(MY_BUILDS_KEY, appState.myBuilds);
            showToast("Rakitan dihapus.", 'success');
            renderApp();
        }

        /** Membagikan build pribadi ke Galeri Publik */
        function shareBuild(build) {
            const buildData = deepClone(build);
            buildData.id = generateId(); // Berikan ID unik untuk galeri publik
            
            buildData.timestamp = Date.now();
            buildData.sharerId = userId;
            buildData.sharerName = build.buildName;

            appState.publicBuilds.push(buildData);
            saveToLocalStorage(GALLERY_KEY, appState.publicBuilds);
            showToast(`Rakitan "${build.buildName}" dibagikan ke galeri publik!`, 'success');
            renderApp();
        }

        // --- Admin/Data Management (Local) ---
        
        /** Menambahkan komponen baru ke data lokal (menggantikan fungsi Firebase Admin) */
        function addNewComponent() {
            const category = document.getElementById('newCompCategory').value;
            const name = document.getElementById('newCompName').value;
            const price = document.getElementById('newCompPrice').value;
            const socket = document.getElementById('newCompSocket').value;
            const ramType = document.getElementById('newCompRamType').value;
            const tdp = document.getElementById('newCompTDP').value;
            const wattage = document.getElementById('newCompWattage').value;

            if (!category || !name || !price) {
                showToast("Kategori, Nama, dan Harga wajib diisi.", 'error');
                return;
            }

            const newComponent = {
                id: generateId(), // ID unik lokal
                category,
                name,
                price: Number(price),
            };

            if (socket) newComponent.socket = socket;
            if (ramType) newComponent.ramType = ramType;
            if (tdp) newComponent.tdp = Number(tdp);
            if (wattage) newComponent.wattage = Number(wattage);
            
            const catLower = category.toLowerCase();
            if (!appState.components[catLower]) {
                 appState.components[catLower] = [];
            }
            appState.components[catLower].push(newComponent);
            
            saveToLocalStorage(COMPONENTS_KEY, appState.components);
            showToast(`Komponen "${name}" ditambahkan!`, 'success');
            
            // Bersihkan bidang input
            document.getElementById('newCompCategory').value = '';
            document.getElementById('newCompName').value = '';
            document.getElementById('newCompPrice').value = '';
            document.getElementById('newCompSocket').value = '';
            document.getElementById('newCompRamType').value = '';
            document.getElementById('newCompTDP').value = '';
            document.getElementById('newCompWattage').value = '';
            
            renderApp();
        }


        // --- View Rendering Functions ---

        /** Merender bilah navigasi utama. */
        function renderNav() {
            const navItems = [
                { id: 'simulator', icon: 'fa-laptop', label: 'Simulator' },
                { id: 'myBuilds', icon: 'fa-folder-open', label: 'Rakitan Saya' },
                { id: 'gallery', icon: 'fa-users', label: 'Galeri' },
                { id: 'admin', icon: 'fa-user-cog', label: 'Admin (Tambah Komp)' },
            ];

            return `
                <nav class="bg-gray-800 shadow-lg p-3 sticky top-0 z-10">
                    <div class="max-w-7xl mx-auto flex justify-between items-center">
                        <h1 class="text-2xl font-bold text-blue-400">RIGVIBES</h1>
                        <div class="flex space-x-2 sm:space-x-4">
                            ${navItems.map(item => `
                                <button onclick="window.app.setView('${item.id}')"
                                    class="${appState.currentView === item.id ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'} text-white text-sm sm:text-base font-medium py-2 px-3 rounded-lg transition duration-150 flex items-center">
                                    <i class="fas ${item.icon} mr-1 sm:mr-2"></i>
                                    <span class="hidden sm:inline">${item.label}</span>
                                </button>
                            `).join('')}
                        </div>
                        <div class="user-id-display">
                            <i class="fas fa-user-shield mr-1"></i> ID: ${userId.substring(0, 8)}...
                        </div>
                    </div>
                </nav>
            `;
        }

        /** Merender modal pemilihan komponen. */
        function renderComponentModal() {
            if (!appState.modal.visible) return '';

            const category = appState.modal.category;
            const components = appState.components[category.toLowerCase()] || [];

            return `
                <div class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-20 p-4">
                    <div class="bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden">
                        <div class="p-5 border-b border-gray-700 flex justify-between items-center">
                            <h2 class="text-xl font-bold text-white">Pilih ${category.toUpperCase()}</h2>
                            <button onclick="window.app.closeModal()" class="text-gray-400 hover:text-white transition">
                                <i class="fas fa-times text-xl"></i>
                            </button>
                        </div>
                        <div class="p-5 scrollable-card">
                            ${components.length > 0 ? components.map(comp => `
                                <div class="component-tile" onclick="window.app.selectComponent('${category}', ${JSON.stringify(comp).replace(/"/g, '&quot;')})">
                                    <p class="font-semibold text-blue-400">${comp.name}</p>
                                    <p class="text-sm text-gray-400">${comp.socket ? `Socket: ${comp.socket}` : ''} ${comp.wattage ? `| ${comp.wattage}W` : ''} ${comp.type ? `| ${comp.type}` : ''}</p>
                                    <p class="text-lg font-bold text-green-400">Rp ${Number(comp.price).toLocaleString('id-ID')}</p>
                                </div>
                            `).join('') : '<p class="text-gray-400 text-center py-4">Tidak ada komponen tersedia dalam kategori ini. Cek panel Admin.</p>'}
                        </div>
                        <div class="p-5 border-t border-gray-700">
                             <button onclick="window.app.closeModal()" class="btn-secondary w-full">Batal</button>
                        </div>
                    </div>
                </div>
            `;
        }


        /** Merender tampilan Simulator PC utama. */
        function renderSimulator() {
            const categories = ['CPU', 'Motherboard', 'RAM', 'GPU', 'PSU', 'Storage', 'Case'];
            const build = appState.currentBuild;
            const status = appState.compatibility.status;
            const statusColor = status === 'Kompatibel' ? 'text-green-400' :
                                status === 'Peringatan' ? 'text-yellow-400' :
                                status === 'Error' ? 'text-red-400' : 'text-gray-400';

            return `
                <div class="max-w-6xl mx-auto p-4 md:p-8 grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Kolom 1: Pemilihan Komponen -->
                    <div class="lg:col-span-2 bg-gray-800 p-6 rounded-xl shadow-xl">
                        <h2 class="text-3xl font-extrabold mb-6 text-white border-b border-gray-700 pb-3">
                            <i class="fas fa-cogs text-blue-400 mr-2"></i> Rakit RIG Anda
                        </h2>

                        <input type="text" id="buildNameInput" value="${build.buildName || 'Rakitan Saya'}"
                               oninput="window.app.updateBuildName(this.value)"
                               placeholder="Masukkan Nama Rakitan"
                               class="w-full mb-6 p-3 bg-gray-900 border border-gray-700 rounded-lg text-lg text-white placeholder-gray-500 focus:ring-blue-500 focus:border-blue-500" />

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${categories.map(cat => `
                                <div class="p-4 bg-gray-900 rounded-lg border border-gray-700 flex flex-col justify-between">
                                    <div>
                                        <p class="text-lg font-semibold mb-1 text-blue-300">${cat.toUpperCase()}</p>
                                        ${build[cat.toLowerCase()] ? `
                                            <p class="text-white font-medium">${build[cat.toLowerCase()].name}</p>
                                            <p class="text-green-400 text-sm">Rp ${Number(build[cat.toLowerCase()].price).toLocaleString('id-ID')}</p>
                                        ` : `
                                            <p class="text-gray-400 italic">Belum Dipilih</p>
                                        `}
                                    </div>
                                    <div class="mt-3 flex space-x-2">
                                        <button onclick="window.app.openModal('${cat}')" class="btn-primary flex-1 text-sm">
                                            ${build[cat.toLowerCase()] ? 'Ubah' : 'Pilih'}
                                        </button>
                                        ${build[cat.toLowerCase()] ? `
                                            <button onclick="window.app.removeComponent('${cat}')" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-3 rounded-lg text-sm transition duration-150">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <div class="mt-8 flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                            <button onclick="window.app.saveBuild()" class="btn-primary flex-1">
                                <i class="fas fa-save mr-2"></i> Simpan Rakitan
                            </button>
                            <button onclick="window.app.clearCurrentBuild()" class="btn-secondary flex-1">
                                <i class="fas fa-undo mr-2"></i> Bersihkan Rakitan
                            </button>
                        </div>
                    </div>

                    <!-- Kolom 2: Status dan Biaya -->
                    <div class="lg:col-span-1 space-y-6">
                        <!-- Kartu Status -->
                        <div class="bg-gray-800 p-6 rounded-xl shadow-xl border-l-4 border-blue-600">
                            <h3 class="text-xl font-bold mb-4 text-white">
                                <i class="fas fa-info-circle mr-2"></i> Status Rakitan
                            </h3>
                            <div class="text-3xl font-extrabold ${statusColor} mb-2">${status.toUpperCase()}</div>
                            <div class="text-xl font-bold text-white mb-4">Total Biaya: <span class="text-green-500">Rp ${appState.cost.toLocaleString('id-ID')}</span></div>

                            <p class="text-lg font-semibold text-gray-300 mb-2">Detail Kompatibilitas:</p>
                            <div class="space-y-2 text-sm scrollable-card p-2">
                                ${appState.compatibility.details.length > 0 ? appState.compatibility.details.map(detail => `
                                    <div class="flex items-start ${detail.type === 'error' ? 'text-red-400' : 'text-yellow-400'}">
                                        <i class="fas ${detail.type === 'error' ? 'fa-times-circle' : 'fa-exclamation-triangle'} mt-1 mr-2"></i>
                                        <span>${detail.message}</span>
                                    </div>
                                `).join('') : `<p class="text-green-500"><i class="fas fa-check-circle mr-2"></i> Semua pemeriksaan dasar telah lulus.</p>`}
                            </div>
                        </div>

                        <!-- Kartu Deskripsi Gemini -->
                        <div class="bg-gray-800 p-6 rounded-xl shadow-xl border-l-4 border-purple-600">
                            <h3 class="text-xl font-bold mb-4 text-white flex justify-between items-center">
                                Wawasan Rakitan AI
                                ${appState.isLoading ? '<i class="fas fa-spinner fa-spin text-purple-400"></i>' : ''}
                            </h3>
                            <p class="text-gray-300 italic mb-4 text-sm">${appState.geminiDescription}</p>
                            <button onclick="window.app.generateBuildDescription()" class="btn-secondary w-full bg-purple-600 hover:bg-purple-700">
                                Buat Deskripsi
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        /** Merender Dasbor "Rakitan Saya". */
        function renderMyBuilds() {
            const builds = appState.myBuilds.sort((a, b) => b.timestamp - a.timestamp); // Sortir berdasarkan waktu terbaru
            return `
                <div class="max-w-7xl mx-auto p-4 md:p-8">
                    <h2 class="text-3xl font-extrabold mb-6 text-white border-b border-gray-700 pb-3">
                        <i class="fas fa-folder-open text-yellow-400 mr-2"></i> Rakitan Saya Tersimpan
                    </h2>
                    ${builds.length === 0 ? `
                        <div class="text-center p-10 bg-gray-800 rounded-xl">
                            <i class="fas fa-box-open text-gray-500 text-4xl mb-3"></i>
                            <p class="text-gray-400">Anda belum menyimpan rakitan apa pun. Mulailah merakit di Simulator!</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${builds.map(build => `
                                <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700 hover:border-blue-500 transition duration-200">
                                    <h3 class="text-xl font-bold text-white mb-2">${build.buildName || 'Rakitan Tanpa Judul'}</h3>
                                    <p class="text-green-400 text-lg font-semibold mb-3">Rp ${Number(build.cost).toLocaleString('id-ID')}</p>
                                    <p class="text-sm text-gray-400 mb-4">${build.description || 'Tidak ada deskripsi tersedia.'}</p>

                                    <div class="flex flex-wrap gap-2 mb-4 text-sm">
                                        <span class="bg-gray-900 px-3 py-1 rounded-full text-gray-300">CPU: ${build.cpu?.name || 'N/A'}</span>
                                        <span class="bg-gray-900 px-3 py-1 rounded-full text-gray-300">GPU: ${build.gpu?.name || 'N/A'}</span>
                                    </div>

                                    <div class="flex flex-wrap gap-3 mt-4">
                                        <button onclick="window.app.loadBuild(${JSON.stringify(build).replace(/"/g, '&quot;')})" class="btn-primary text-sm flex-1 min-w-0">
                                            <i class="fas fa-download mr-1"></i> Muat
                                        </button>
                                        <button onclick="window.app.shareBuild(${JSON.stringify(build).replace(/"/g, '&quot;')})" class="bg-blue-800 hover:bg-blue-700 text-white font-semibold py-2 px-3 rounded-lg text-sm transition duration-150 flex-1 min-w-0">
                                            <i class="fas fa-share-alt mr-1"></i> Bagikan
                                        </button>
                                        <button onclick="window.app.deleteBuild('${build.id}')" class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-3 rounded-lg text-sm transition duration-150">
                                            <i class="fas fa-trash"></i> Hapus
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        /** Merender tampilan Galeri Publik. */
        function renderGallery() {
            // Sortir Galeri secara lokal berdasarkan waktu terbaru
            const builds = appState.publicBuilds.sort((a, b) => b.timestamp - a.timestamp);
            return `
                <div class="max-w-7xl mx-auto p-4 md:p-8">
                    <h2 class="text-3xl font-extrabold mb-6 text-white border-b border-gray-700 pb-3">
                        <i class="fas fa-globe text-blue-400 mr-2"></i> Galeri RIG Publik
                    </h2>
                    ${builds.length === 0 ? `
                        <div class="text-center p-10 bg-gray-800 rounded-xl">
                            <i class="fas fa-star text-gray-500 text-4xl mb-3"></i>
                            <p class="text-gray-400">Galeri masih kosong! Jadilah yang pertama membagikan rakitan.</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${builds.map(build => `
                                <div class="bg-gray-800 p-5 rounded-xl shadow-lg border border-gray-700">
                                    <h3 class="text-xl font-bold text-blue-300 truncate mb-1">${build.buildName || 'Rakitan Bersama'}</h3>
                                    <p class="text-sm text-gray-400 mb-3">Dibagikan oleh: ${build.sharerId.substring(0, 8)}...</p>
                                    <p class="text-green-400 text-lg font-semibold mb-2">Rp ${Number(build.cost).toLocaleString('id-ID')}</p>
                                    <p class="text-xs text-gray-500 italic mb-3">Kompatibilitas: <span class="${build.compatibility === 'Kompatibel' ? 'text-green-500' : 'text-yellow-500'}">${build.compatibility}</span></p>

                                    <p class="text-sm text-gray-300 mb-4 line-clamp-3">${build.description || 'Karya agung komponen.'}</p>

                                    <button onclick="window.app.loadBuild(${JSON.stringify(build).replace(/"/g, '&quot;')})" class="btn-primary w-full text-sm">
                                        <i class="fas fa-eye mr-1"></i> Lihat & Salin
                                    </button>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        /** Merender tampilan Admin/Tambah Komponen (Manajemen Sederhana). */
        function renderAdmin() {
            const categories = ['CPU', 'Motherboard', 'RAM', 'GPU', 'PSU', 'Storage', 'Case'];
            return `
                <div class="max-w-xl mx-auto p-4 md:p-8">
                    <h2 class="text-3xl font-extrabold mb-6 text-white border-b border-gray-700 pb-3">
                        <i class="fas fa-plus-circle text-red-400 mr-2"></i> Admin: Tambah Komponen
                    </h2>
                    <div id="addComponentForm" class="bg-gray-800 p-6 rounded-xl shadow-xl space-y-4">
                        <p class="text-sm text-red-400">Penting: Komponen yang ditambahkan di sini akan disimpan di LocalStorage browser Anda.</p>
                        <select id="newCompCategory" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white">
                            <option value="">-- Pilih Kategori --</option>
                            ${categories.map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                        </select>
                        <input type="text" id="newCompName" placeholder="Nama Komponen (cth: RTX 4080)" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white" />
                        <input type="number" id="newCompPrice" placeholder="Harga (USD)" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white" />
                        <input type="text" id="newCompSocket" placeholder="Socket (cth: LGA1700, opsional)" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white" />
                        <input type="text" id="newCompRamType" placeholder="Tipe RAM (cth: DDR5, opsional)" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white" />
                        <input type="number" id="newCompTDP" placeholder="TDP (W, opsional)" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white" />
                        <input type="number" id="newCompWattage" placeholder="Watt PSU (W, opsional)" class="w-full p-3 bg-gray-900 border border-gray-700 rounded-lg text-white" />

                        <button onclick="window.app.addNewComponent()" class="btn-primary w-full bg-red-600 hover:bg-red-700">
                            <i class="fas fa-plus mr-2"></i> Tambahkan Komponen Lokal
                        </button>
                    </div>
                </div>
            `;
        }

        /** Fungsi rendering utama */
        function renderApp() {
            const appDiv = document.getElementById('app');
            let content = '';

            switch (appState.currentView) {
                case 'simulator': content = renderSimulator(); break;
                case 'myBuilds': content = renderMyBuilds(); break;
                case 'gallery': content = renderGallery(); break;
                case 'admin': content = renderAdmin(); break;
                default: content = renderSimulator();
            }

            const toastHtml = appState.toast.visible ? `
                <div class="fixed top-4 right-4 z-30 p-4 rounded-lg shadow-xl text-white ${appState.toast.type === 'success' ? 'bg-green-600' : appState.toast.type === 'error' ? 'bg-red-600' : 'bg-blue-600'} transition duration-300">
                    <i class="fas ${appState.toast.type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'} mr-2"></i>
                    ${appState.toast.message}
                </div>
            ` : '';

            appDiv.innerHTML = renderNav() + content + renderComponentModal() + toastHtml;
        }

        // --- Metode Global untuk Interaktivitas HTML ---
        window.app = {
            setView: (view) => { appState.currentView = view; renderApp(); },
            openModal: (category) => {
                appState.modal = { visible: true, category: category };
                renderApp();
            },
            closeModal: () => {
                appState.modal = { visible: false, category: null };
                renderApp();
            },
            selectComponent: (category, component) => {
                appState.currentBuild = {
                    ...appState.currentBuild,
                    [category.toLowerCase()]: component
                };
                appState.modal = { visible: false, category: null };
                calculateBuildStatus();
                renderApp();
            },
            removeComponent: (category) => {
                const newBuild = { ...appState.currentBuild };
                delete newBuild[category.toLowerCase()];
                appState.currentBuild = newBuild;
                calculateBuildStatus();
                renderApp();
            },
            updateBuildName: (name) => {
                appState.currentBuild = { ...appState.currentBuild, buildName: name };
                renderApp();
            },
            saveBuild: saveBuild,
            loadBuild: loadBuild,
            deleteBuild: deleteBuild,
            shareBuild: shareBuild,
            addNewComponent: addNewComponent,
            clearCurrentBuild: clearCurrentBuild,
            generateBuildDescription: generateBuildDescription,
        };

        // Inisialisasi pada saat pemuatan jendela
        window.onload = () => {
            initData(); // Memuat data dari LocalStorage atau Mock Data
        };

    </script>

    <div id="app" class="min-h-screen">
        <!-- Aplikasi dirender di sini -->
    </div>
</body>
</html>